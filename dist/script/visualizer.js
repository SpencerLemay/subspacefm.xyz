window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;var visualizerStart=function(){var e,t,a,i,r,n,c,o;switch(1!=player.started&&(player.started=0,delete e,delete t,delete c,delete o),player.started=1,e=new AudioContext,t=e.createAnalyser(),e.createMediaElementSource(player.audioElement).connect(t),t.connect(e.destination),new Uint8Array(t.frequencyBinCount),localStorage.getItem("theme")){case"theme-dark":r=[1,"#717e80"],i=[.5,"#3d4445"],a=[0,"#131b1c"],n="#131b1c";break;default:case"theme-light":r=[1,"#000"],i=[.5,"#777"],a=[0,"#bbb"],n="#000";break;case"theme-pink":r=[1,"#af9bbb"],i=[.5,"#c5bdc9"],a=[0,"#fff"],n="#fff"}c=document.getElementById("canvas"),cwidth=c.width,cheight=c.height-2,meterWidth=10,gap=2,capHeight=2,capStyle=n,meterNum=800/12,capYPositionArray=[],e=c.getContext("2d"),(o=e.createLinearGradient(0,0,0,300)).addColorStop(r[0],r[1]),o.addColorStop(i[0],i[1]),o.addColorStop(a[0],a[1]),function a(){var i=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(i);var r=Math.round(i.length/meterNum);e.clearRect(0,0,cwidth,cheight);for(var n=0;n<meterNum;n++){var c=i[n*r];capYPositionArray.length<Math.round(meterNum)&&capYPositionArray.push(c),e.fillStyle=capStyle,c<capYPositionArray[n]?e.fillRect(12*n,cheight- --capYPositionArray[n],meterWidth,capHeight):(e.fillRect(12*n,cheight-c,meterWidth,capHeight),capYPositionArray[n]=c),e.fillStyle=o,e.fillRect(12*n,cheight-c+capHeight,meterWidth,cheight)}requestAnimationFrame(a)}()};$((function(){$("#dark").click((function(){visualizerStart()})),$("#play").click((function(){visualizerStart()}))}));